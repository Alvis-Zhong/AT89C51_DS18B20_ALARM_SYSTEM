C51 COMPILER V9.56.0.0   BSP_DS18B20                                                       02/22/2017 17:59:04 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE BSP_DS18B20
OBJECT MODULE PLACED IN .\Objects\bsp_ds18b20.obj
COMPILER INVOKED BY: D:\51Keil_v5\C51\BIN\C51.EXE DS18B20\bsp_ds18b20.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\DS18B20;.\LCD1
                    -602;..\BSP;.\key_set;.\Warning) DEBUG OBJECTEXTEND PRINT(.\Listings\bsp_ds18b20.lst) OBJECT(.\Objects\bsp_ds18b20.obj)

line level    source

   1          /*******************************************************************
   2                  ************************************************************
   3                  *
   4                  *@file     bsp_ds18b20.c
   5                  *@author   Bin
   6                  *@data     2017.02
   7                  *@brief    DS18B20的驱动模块
   8                  *
   9                  *************************************************************
  10          *********************************************************************/
  11          #include <bsp_ds18b20.h>
  12          
  13          uchar temp_value[] = {0x00,0x00} ;
  14          bit read_temp_is_ok = 0 ;
  15          
  16          /****************************************************************************************
  17                  *@brief         简单的软件延时函数
  18                  *@param         形参i用于设置延时的长短
  19                  *@retvel        无
  20          *****************************************************************************************/
  21          void delay(uint i)
  22          {
  23   1              while(i--) ; 
  24   1      }
  25          
  26          /****************************************************************************************
  27                  *@brief         DS18B20初始化函数
  28                  *@param         无
  29                  *@retvel        无
  30          *****************************************************************************************/
  31          uchar ds18b20_init()
  32          {
  33   1              uchar status = 0; 
  34   1              DQ = 1  ; 
  35   1              delay(8) ; 
  36   1              DQ = 0 ; 
  37   1              delay(80) ; 
  38   1              DQ = 1 ;
  39   1              delay(14) ;
  40   1              status = DQ ; 
  41   1              delay(20) ; 
  42   1              return status ;  
  43   1      }
  44          
  45          /****************************************************************************************
  46                  *@brief         向DS18B20写入一个比特
  47                  *@param         参数dat是要写入的数值
  48                  *@retvel        无
  49          *****************************************************************************************/
  50          void ds18b20_write_byte(uchar dat)
  51          {
  52   1              uchar i ;                                                                                               
  53   1              for(i=0;i<8;i++)
  54   1              {
C51 COMPILER V9.56.0.0   BSP_DS18B20                                                       02/22/2017 17:59:04 PAGE 2   

  55   2                      DQ = 0 ; 
  56   2                      DQ = dat & 0x01 ; 
  57   2                      delay(5) ; 
  58   2                      DQ = 1 ; 
  59   2                      dat >>= 1 ;
  60   2              }
  61   1      }
  62          
  63          /****************************************************************************************
  64                  *@brief         从DS18B20读取数值
  65                  *@param         无
  66                  *@retvel        返回读取到的一个比特的数值
  67          *****************************************************************************************/
  68          uchar ds18b20_read_byte()
  69          {
  70   1              uchar i,dat=0 ;
  71   1              DQ = 1 ;
  72   1              _nop_() ; 
  73   1              for(i=0;i<8;i++)
  74   1              {
  75   2                      DQ = 0 ;
  76   2                      dat>>=1 ; 
  77   2                      DQ = 1 ;
  78   2                      _nop_() ; 
  79   2                      _nop_() ; 
  80   2                      if(DQ==1)
  81   2                              dat |= 0x80 ; 
  82   2                      delay(30) ;
  83   2                      DQ = 1 ;                
  84   2              }
  85   1              return dat ; 
  86   1      }
  87          
  88          /****************************************************************************************
  89                  *@brief         完整的读取一次温度
  90                  *@param         无
  91                  *@retvel        如果读取成功，将读取成功的标志位置1
  92          *****************************************************************************************/
  93          void read_temperature()
  94          {
  95   1              if(ds18b20_init()==1)
  96   1              {
  97   2                      read_temp_is_ok = 0 ;
  98   2              }
  99   1              else
 100   1              {
 101   2                      ds18b20_write_byte(0xcc) ; 
 102   2                      ds18b20_write_byte(0x44) ; 
 103   2                      ds18b20_init() ; 
 104   2                      ds18b20_write_byte(0xcc) ; 
 105   2                      ds18b20_write_byte(0xbe) ; 
 106   2                      temp_value[0] =ds18b20_read_byte() ; 
 107   2                      temp_value[1] =ds18b20_read_byte() ;
 108   2                      read_temp_is_ok = 1 ;
 109   2              }
 110   1      }
 111          
 112          
 113          
 114          
 115          
 116          
C51 COMPILER V9.56.0.0   BSP_DS18B20                                                       02/22/2017 17:59:04 PAGE 3   

 117          
 118          
 119          
 120          
 121          
 122          
 123          
 124          
 125          
 126          
 127          
 128          
 129          
 130          
 131          
 132          
 133          
 134          
 135          
 136          
 137          
 138          
 139          
 140          
 141          
 142          
 143          
 144          
 145          
 146          
 147          
 148          
 149          
 150          
 151          
 152          
 153          
 154          
 155          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
